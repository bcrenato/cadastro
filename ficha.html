<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ficha do Membro</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    #foto {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 50%;
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
      display: block;
      margin: 0 auto 15px;
    }
    .edit-mode {
      display: none;
    }
    #fotoPreview {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 50%;
      margin: 0 auto 15px;
      display: block;
    }
    #fotoInput {
      display: none;
    }
    .foto-container {
      position: relative;
      margin: 0 auto;
      width: 150px;
    }
    .foto-upload-btn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.5);
      color: white;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .header-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .pdf-form {
      display: none;
    }
    .pdf-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .pdf-header img {
      max-width: 150px;
      height: auto;
    }
    .pdf-title {
      font-size: 24px;
      font-weight: bold;
      margin: 10px 0;
    }
    .pdf-photo-container {
      float: left;
      margin-right: 20px;
      margin-bottom: 20px;
      text-align: center;
    }
    .pdf-photo {
      width: 100px;
      height: 120px;
      object-fit: cover;
      border: 1px solid #000;
      margin-bottom: 5px;
    }
    .pdf-personal-info {
      overflow: hidden;
    }
    .pdf-section {
      margin-bottom: 15px;
    }
    .pdf-section-title {
      font-weight: bold;
      border-bottom: 1px solid #000;
      margin-bottom: 5px;
    }
    .pdf-row {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 5px;
    }
    .pdf-col {
      flex: 1;
      min-width: 200px;
      margin-right: 10px;
    }
    .pdf-checkbox {
      display: inline-flex;
      align-items: center;
      margin-right: 15px;
    }
    .pdf-checkbox input {
      margin-right: 5px;
    }
  </style>
</head>
<body>

  <!-- üîπ SCRIPT DE VERIFICA√á√ÉO DE AUTENTICA√á√ÉO -->
  <script type="module">
  import { checkAuth } from './auth.js';
  checkAuth();
  </script>

  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="#">Cadastro Igreja</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Cadastro</a></li>
          <li class="nav-item"><a class="nav-link" href="listagem.html">Listagem</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-5" style="max-width: 800px;">
    <div class="header-actions">
      <h2 class="mb-0">Ficha do Membro</h2>
      <div>
        <button id="editBtn" class="btn btn-primary me-2">Editar</button>
        <button id="pdfBtn" class="btn btn-success">Salvar PDF</button>
      </div>
    </div>
    
    <div class="card p-4 shadow-sm">
      <!-- Modo Visualiza√ß√£o -->
      <div id="viewMode">
        <img id="foto" alt="Foto do membro" />
        <p><strong>Nome:</strong> <span id="nome"></span></p>
        <p><strong>CEP:</strong> <span id="cep"></span></p>
        <p><strong>Endere√ßo:</strong> <span id="endereco"></span></p>
        <p><strong>Bairro:</strong> <span id="bairro"></span></p>
        <p><strong>Cidade:</strong> <span id="cidade"></span></p>
        <p><strong>Estado:</strong> <span id="estado"></span></p>
        <p><strong>Data de Batismo:</strong> <span id="batismo"></span></p>
        <p><strong>Data de Nascimento:</strong> <span id="nascimento"></span></p>
        <p><strong>Fun√ß√£o:</strong> <span id="funcao"></span></p>
        <p><strong>Telefone:</strong> <span id="telefone"></span></p>
        <p><strong>Sexo:</strong> <span id="sexo"></span></p>
        <a href="listagem.html" class="btn btn-outline-primary mt-3">‚Üê Voltar para lista</a>
      </div>

      <!-- Modo Edi√ß√£o -->
      <form id="editMode" class="edit-mode">
        <div class="foto-container">
          <img id="fotoPreview" alt="Preview da foto" />
          <label for="fotoInput" class="foto-upload-btn">
            <i class="bi bi-camera"></i>
          </label>
          <input type="file" id="fotoInput" accept="image/*" />
        </div>

        <div class="mb-3">
          <label for="editNome" class="form-label">Nome</label>
          <input type="text" class="form-control" id="editNome" required>
        </div>
        <div class="mb-3">
          <label for="editCep" class="form-label">CEP</label>
          <input type="text" class="form-control" id="editCep">
        </div>
        <div class="mb-3">
          <label for="editEndereco" class="form-label">Endere√ßo</label>
          <input type="text" class="form-control" id="editEndereco">
        </div>
        <div class="mb-3">
          <label for="editBairro" class="form-label">Bairro</label>
          <input type="text" class="form-control" id="editBairro">
        </div>
        <div class="mb-3">
          <label for="editCidade" class="form-label">Cidade</label>
          <input type="text" class="form-control" id="editCidade">
        </div>
        <div class="mb-3">
          <label for="editEstado" class="form-label">Estado</label>
          <input type="text" class="form-control" id="editEstado">
        </div>
        <div class="mb-3">
          <label for="editBatismo" class="form-label">Data de Batismo</label>
          <input type="date" class="form-control" id="editBatismo">
        </div>
        <div class="mb-3">
          <label for="editNascimento" class="form-label">Data de Nascimento</label>
          <input type="date" class="form-control" id="editNascimento">
        </div>
        <div class="mb-3">
          <label for="editFuncao" class="form-label">Fun√ß√£o</label>
          <select class="form-select" id="editFuncao" required>
            <option value="">Selecione uma fun√ß√£o</option>
            <option value="Pastor">Pastor</option>
            <option value="Mission√°rio(a)">Mission√°rio(a)</option>
            <option value="Di√°cono">Di√°cono</option>
            <option value="Obreiro(a)">Obreiro(a)</option>
            <option value="Membro">Membro</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="editTelefone" class="form-label">Telefone</label>
          <input type="tel" class="form-control" id="editTelefone">
        </div>
        <div class="mb-3">
          <label for="editSexo" class="form-label">Sexo</label>
          <select class="form-select" id="editSexo">
            <option value="masculino">Masculino</option>
            <option value="feminino">Feminino</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="editPai" class="form-label">Pai</label>
          <input type="text" class="form-control" id="editPai">
        </div>
        <div class="mb-3">
          <label for="editMae" class="form-label">M√£e</label>
          <input type="text" class="form-control" id="editMae">
        </div>
        <div class="mb-3">
          <label for="editFilhos" class="form-label">Filhos</label>
          <input type="text" class="form-control" id="editFilhos">
        </div>
        <div class="mb-3">
          <label for="editAmigo" class="form-label">Nome do Amigo</label>
          <input type="text" class="form-control" id="editAmigo">
        </div>
        <div class="mb-3">
          <label for="editAmigoTelefone" class="form-label">Telefone do Amigo</label>
          <input type="text" class="form-control" id="editAmigoTelefone">
        </div>
        <div class="mb-3">
          <label class="form-label">Estado Civil</label>
          <div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="editEstadoCivil" id="editCasado" value="Casado(a)">
              <label class="form-check-label" for="editCasado">Casado(a)</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="editEstadoCivil" id="editSolteiro" value="Solteiro(a)">
              <label class="form-check-label" for="editSolteiro">Solteiro(a)</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="editEstadoCivil" id="editViuvo" value="Vi√∫vo(a)">
              <label class="form-check-label" for="editViuvo">Vi√∫vo(a)</label>
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label for="editProfissao" class="form-label">Profiss√£o</label>
          <input type="text" class="form-control" id="editProfissao">
        </div>
        <div class="mb-3">
          <label for="editEmail" class="form-label">E-mail</label>
          <input type="email" class="form-control" id="editEmail">
        </div>
        <div class="mb-3">
          <label for="editIdentidade" class="form-label">Identidade</label>
          <input type="text" class="form-control" id="editIdentidade">
        </div>
        <div class="mb-3">
          <label for="editCPF" class="form-label">CPF</label>
          <input type="text" class="form-control" id="editCPF">
        </div>
        <div class="mb-3">
          <label for="editOrigem" class="form-label">Origem (√∫ltima Igreja)</label>
          <input type="text" class="form-control" id="editOrigem">
        </div>
        <div class="mb-3">
          <label class="form-label">Foi aceito como membro por:</label>
          <div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="editAclamacao">
              <label class="form-check-label" for="editAclamacao">Aclama√ß√£o</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="editBatismoCheck">
              <label class="form-check-label" for="editBatismoCheck">Batismo</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="editCartaTransferencia">
              <label class="form-check-label" for="editCartaTransferencia">Carta de Transfer√™ncia</label>
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label for="editDataAceito" class="form-label">Data</label>
          <input type="date" class="form-control" id="editDataAceito">
        </div>
        <div class="d-flex justify-content-between mt-3">
          <button type="button" id="cancelEditBtn" class="btn btn-outline-secondary">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
    </div>

    <!-- Formul√°rio para PDF (oculto) -->
    <div id="pdfForm" class="pdf-form">
      <div class="pdf-header">
        <img src="logo.png" alt="Logo" id="pdfLogo">
        <div class="pdf-title">Fam√≠lias na Un√ß√£o</div>
        <div class="pdf-title">Ficha de Membro</div>
      </div>
      
      <div class="pdf-section">
        <div class="pdf-photo-container">
          <img id="pdfPhoto" class="pdf-photo" src="https://via.placeholder.com/100x120?text=Foto+3x4">
          <div>Telefone: <span id="pdfTelefone"></span></div>
        </div>
        
        <div class="pdf-personal-info">
          <div class="pdf-row">
            <div class="pdf-col">
              <div>Nome: <span id="pdfNome"></span></div>
              <div>Nascimento: <span id="pdfNascimento"></span></div>
              <div>Batismo: <span id="pdfBatismo"></span></div>
            </div>
            <div class="pdf-col">
              <div>Endere√ßo: <span id="pdfEndereco"></span></div>
              <div>Bairro: <span id="pdfBairro"></span></div>
              <div>Cidade/Estado: <span id="pdfCidadeEstado"></span></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="pdf-section">
        <div class="pdf-section-title">Dados Pessoais</div>
        <div class="pdf-row">
          <div class="pdf-col">
            <div>Pai: <span id="pdfPai"></span></div>
            <div>M√£e: <span id="pdfMae"></span></div>
            <div>Filhos: <span id="pdfFilhos"></span></div>
          </div>
          <div class="pdf-col">
            <div>Amigo: <span id="pdfAmigo"></span></div>
            <div>Tel. Amigo: <span id="pdfAmigoTelefone"></span></div>
          </div>
          <div class="pdf-col">
            <div>Estado Civil: <span id="pdfEstadoCivil"></span></div>
            <div>Profiss√£o: <span id="pdfProfissao"></span></div>
            <div>E-mail: <span id="pdfEmail"></span></div>
          </div>
        </div>
        <div class="pdf-row">
          <div class="pdf-col">
            <div>Identidade: <span id="pdfIdentidade"></span></div>
            <div>CPF: <span id="pdfCPF"></span></div>
          </div>
          <div class="pdf-col">
            <div>Origem (√∫ltima Igreja): <span id="pdfOrigem"></span></div>
          </div>
        </div>
      </div>
      
      <div class="pdf-section">
        <div class="pdf-section-title">Aceita√ß√£o como Membro</div>
        <div class="pdf-row">
          <div class="pdf-checkbox">
            <input type="checkbox" id="pdfAclamacao" disabled>
            <label for="pdfAclamacao">Aclama√ß√£o</label>
          </div>
          <div class="pdf-checkbox">
            <input type="checkbox" id="pdfBatismoCheck" disabled>
            <label for="pdfBatismoCheck">Batismo</label>
          </div>
          <div class="pdf-checkbox">
            <input type="checkbox" id="pdfCartaTransferencia" disabled>
            <label for="pdfCartaTransferencia">Carta de Transfer√™ncia</label>
          </div>
        </div>
        <div>Data: <span id="pdfDataAceito"></span></div>
      </div>
    </div>
  </main>

  <script type="module">
    import { db, storage } from './firebase-config.js';
    import { ref, get, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
    import { ref as storageRef, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    let membroData = {};
    let currentFotoURL = '';

    // Elementos do DOM
    const viewMode = document.getElementById('viewMode');
    const editMode = document.getElementById('editMode');
    const editBtn = document.getElementById('editBtn');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const fotoInput = document.getElementById('fotoInput');
    const fotoPreview = document.getElementById('fotoPreview');
    const fotoView = document.getElementById('foto');
    const pdfBtn = document.getElementById('pdfBtn');

    // Fun√ß√£o para alternar entre modos de visualiza√ß√£o e edi√ß√£o
    function toggleEditMode(isEditing) {
      if (isEditing) {
        viewMode.style.display = 'none';
        editMode.style.display = 'block';
        editBtn.style.display = 'none';
      } else {
        viewMode.style.display = 'block';
        editMode.style.display = 'none';
        editBtn.style.display = 'block';
      }
    }

    // Carregar dados do membro
    if (!id) {
      document.querySelector('.card').innerHTML = '<p class="text-danger">Membro n√£o encontrado.</p>';
    } else {
      const membroRef = ref(db, `membros/${id}`);

      get(membroRef).then((snapshot) => {
        if (snapshot.exists()) {
          membroData = snapshot.val();
          currentFotoURL = membroData.fotoURL || '';

          // Preencher modo visualiza√ß√£o
          document.getElementById("nome").textContent = membroData.nome || '';
          document.getElementById("cep").textContent = membroData.cep || '';
          document.getElementById("endereco").textContent = membroData.endereco || '';
          document.getElementById("bairro").textContent = membroData.bairro || '';
          document.getElementById("cidade").textContent = membroData.cidade || '';
          document.getElementById("estado").textContent = membroData.estado || '';
          document.getElementById("batismo").textContent = membroData.batismo || '';
          document.getElementById("nascimento").textContent = membroData.nascimento || '';
          document.getElementById("funcao").textContent = membroData.funcao || '';
          document.getElementById("telefone").textContent = membroData.telefone || '';
          document.getElementById("sexo").textContent = membroData.sexo || '';

          if (membroData.fotoURL) {
            fotoView.src = membroData.fotoURL;
            fotoView.style.display = "block";
            fotoPreview.src = membroData.fotoURL;
          } else {
            fotoView.style.display = "none";
            fotoPreview.src = "https://via.placeholder.com/150?text=Sem+Foto";
          }

          // Preencher formul√°rio de edi√ß√£o
          document.getElementById("editNome").value = membroData.nome || '';
          document.getElementById("editCep").value = membroData.cep || '';
          document.getElementById("editEndereco").value = membroData.endereco || '';
          document.getElementById("editBairro").value = membroData.bairro || '';
          document.getElementById("editCidade").value = membroData.cidade || '';
          document.getElementById("editEstado").value = membroData.estado || '';
          document.getElementById("editBatismo").value = membroData.batismo || '';
          document.getElementById("editNascimento").value = membroData.nascimento || '';
          document.getElementById("editTelefone").value = membroData.telefone || '';
          document.getElementById("editSexo").value = membroData.sexo || 'Masculino';
          document.getElementById("editPai").value = membroData.pai || '';
          document.getElementById("editMae").value = membroData.mae || '';
          document.getElementById("editFilhos").value = membroData.filhos || '';
          document.getElementById("editAmigo").value = membroData.amigo || '';
          document.getElementById("editAmigoTelefone").value = membroData.amigoTelefone || '';
          document.getElementById("editProfissao").value = membroData.profissao || '';
          document.getElementById("editEmail").value = membroData.email || '';
          document.getElementById("editIdentidade").value = membroData.identidade || '';
          document.getElementById("editCPF").value = membroData.cpf || '';
          document.getElementById("editOrigem").value = membroData.origem || '';
          document.getElementById("editDataAceito").value = membroData.dataAceito || '';

          // Estado Civil
          if (membroData.estadoCivil) {
            document.querySelector(`input[name="editEstadoCivil"][value="${membroData.estadoCivil}"]`).checked = true;
          }

          // Aceita√ß√£o como membro
          if (membroData.aclamacao) document.getElementById("editAclamacao").checked = membroData.aclamacao;
          if (membroData.batismoCheck) document.getElementById("editBatismoCheck").checked = membroData.batismoCheck;
          if (membroData.cartaTransferencia) document.getElementById("editCartaTransferencia").checked = membroData.cartaTransferencia;

          // Preencher o campo de fun√ß√£o
          const funcoes = ["Pastor", "Mission√°rio(a)", "Di√°cono", "Obreiro(a)", "Membro"];
          const funcaoSelect = document.getElementById("editFuncao");
          const funcaoAtual = membroData.funcao || "";

          if (funcaoAtual && !funcoes.includes(funcaoAtual)) {
            const option = document.createElement("option");
            option.value = funcaoAtual;
            option.textContent = funcaoAtual;
            option.selected = true;
            funcaoSelect.appendChild(option);
          }

          funcaoSelect.value = funcaoAtual || "Membro";
        } else {
          document.querySelector('.card').innerHTML = '<p class="text-danger">Membro n√£o encontrado.</p>';
        }
      }).catch((error) => {
        console.error("Erro ao buscar membro:", error);
      });
    }

    // Event Listeners
    editBtn.addEventListener('click', () => toggleEditMode(true));
    cancelEditBtn.addEventListener('click', () => toggleEditMode(false));

    // Upload de nova foto
    fotoInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          fotoPreview.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // Envio do formul√°rio de edi√ß√£o
    editMode.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      let fotoURL = currentFotoURL;
      let shouldDeleteOldPhoto = false;
      
      // Se uma nova foto foi selecionada
      if (fotoInput.files[0]) {
        try {
          // Se havia uma foto antiga, marcamos para deletar
          if (currentFotoURL) {
            shouldDeleteOldPhoto = true;
          }
          
          // Upload da nova foto
          const file = fotoInput.files[0];
          const fileRef = storageRef(storage, `membros/${id}/${file.name}`);
          await uploadBytes(fileRef, file);
          fotoURL = await getDownloadURL(fileRef);
        } catch (error) {
          console.error("Erro ao fazer upload da foto:", error);
          alert("Erro ao atualizar a foto. Os outros dados foram salvos.");
        }
      }
      
      // Atualizar dados no banco de dados
      const updatedData = {
        nome: document.getElementById("editNome").value,
        cep: document.getElementById("editCep").value,
        endereco: document.getElementById("editEndereco").value,
        bairro: document.getElementById("editBairro").value,
        cidade: document.getElementById("editCidade").value,
        estado: document.getElementById("editEstado").value,
        batismo: document.getElementById("editBatismo").value,
        nascimento: document.getElementById("editNascimento").value,
        funcao: document.getElementById("editFuncao").value,
        telefone: document.getElementById("editTelefone").value,
        sexo: document.getElementById("editSexo").value,
        fotoURL: fotoURL,
        pai: document.getElementById("editPai").value,
        mae: document.getElementById("editMae").value,
        filhos: document.getElementById("editFilhos").value,
        amigo: document.getElementById("editAmigo").value,
        amigoTelefone: document.getElementById("editAmigoTelefone").value,
        estadoCivil: document.querySelector('input[name="editEstadoCivil"]:checked')?.value || '',
        profissao: document.getElementById("editProfissao").value,
        email: document.getElementById("editEmail").value,
        identidade: document.getElementById("editIdentidade").value,
        cpf: document.getElementById("editCPF").value,
        origem: document.getElementById("editOrigem").value,
        dataAceito: document.getElementById("editDataAceito").value,
        aclamacao: document.getElementById("editAclamacao").checked,
        batismoCheck: document.getElementById("editBatismoCheck").checked,
        cartaTransferencia: document.getElementById("editCartaTransferencia").checked
      };

      try {
        await update(ref(db, `membros/${id}`), updatedData);
        
        // Se tudo deu certo, deletar a foto antiga se necess√°rio
        if (shouldDeleteOldPhoto) {
          try {
            const oldPhotoRef = storageRef(storage, currentFotoURL);
            await deleteObject(oldPhotoRef);
          } catch (error) {
            console.error("Erro ao deletar foto antiga:", error);
          }
        }
        
        // Atualizar a visualiza√ß√£o com os novos dados
        membroData = updatedData;
        currentFotoURL = fotoURL;
        
        document.getElementById("nome").textContent = updatedData.nome;
        document.getElementById("cep").textContent = updatedData.cep;
        document.getElementById("endereco").textContent = updatedData.endereco;
        document.getElementById("bairro").textContent = updatedData.bairro;
        document.getElementById("cidade").textContent = updatedData.cidade;
        document.getElementById("estado").textContent = updatedData.estado;
        document.getElementById("batismo").textContent = updatedData.batismo;
        document.getElementById("nascimento").textContent = updatedData.nascimento;
        document.getElementById("funcao").textContent = updatedData.funcao;
        document.getElementById("telefone").textContent = updatedData.telefone;
        document.getElementById("sexo").textContent = updatedData.sexo;
        
        if (fotoURL) {
          fotoView.src = fotoURL;
          fotoView.style.display = "block";
        } else {
          fotoView.style.display = "none";
        }
        
        toggleEditMode(false);
        alert("Dados atualizados com sucesso!");
      } catch (error) {
        console.error("Erro ao atualizar membro:", error);
        alert("Erro ao atualizar membro. Por favor, tente novamente.");
      }
    });

    // Gerar PDF
    pdfBtn.addEventListener('click', async () => {
      // Preencher o formul√°rio PDF com os dados
      document.getElementById('pdfNome').textContent = membroData.nome || '';
      document.getElementById('pdfNascimento').textContent = membroData.nascimento || '';
      document.getElementById('pdfBatismo').textContent = membroData.batismo || '';
      document.getElementById('pdfTelefone').textContent = membroData.telefone || '';
      document.getElementById('pdfEndereco').textContent = membroData.endereco || '';
      document.getElementById('pdfBairro').textContent = membroData.bairro || '';
      document.getElementById('pdfCidadeEstado').textContent = `${membroData.cidade || ''}/${membroData.estado || ''}`;
      document.getElementById('pdfPai').textContent = membroData.pai || '';
      document.getElementById('pdfMae').textContent = membroData.mae || '';
      document.getElementById('pdfFilhos').textContent = membroData.filhos || '';
      document.getElementById('pdfAmigo').textContent = membroData.amigo || '';
      document.getElementById('pdfAmigoTelefone').textContent = membroData.amigoTelefone || '';
      document.getElementById('pdfEstadoCivil').textContent = membroData.estadoCivil || '';
      document.getElementById('pdfProfissao').textContent = membroData.profissao || '';
      document.getElementById('pdfEmail').textContent = membroData.email || '';
      document.getElementById('pdfIdentidade').textContent = membroData.identidade || '';
      document.getElementById('pdfCPF').textContent = membroData.cpf || '';
      document.getElementById('pdfOrigem').textContent = membroData.origem || '';
      document.getElementById('pdfDataAceito').textContent = membroData.dataAceito || '';
      
      // Checkboxes
      document.getElementById('pdfAclamacao').checked = membroData.aclamacao || false;
      document.getElementById('pdfBatismoCheck').checked = membroData.batismoCheck || false;
      document.getElementById('pdfCartaTransferencia').checked = membroData.cartaTransferencia || false;
      
      // Foto
      const pdfPhoto = document.getElementById('pdfPhoto');
      if (membroData.fotoURL) {
        pdfPhoto.src = membroData.fotoURL;
      } else {
        pdfPhoto.src = 'https://via.placeholder.com/100x120?text=Foto+3x4';
      }
      
      // Mostrar o formul√°rio PDF temporariamente
      const pdfForm = document.getElementById('pdfForm');
      pdfForm.style.display = 'block';
      
      // Gerar PDF
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      
      await html2canvas(pdfForm, {
        scale: 2,
        logging: false,
        useCORS: true
      }).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const imgWidth = 210; // A4 width in mm
        const pageHeight = 295; // A4 height in mm
        const imgHeight = canvas.height * imgWidth / canvas.width;
        let heightLeft = imgHeight;
        let position = 0;
        
        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
        
        while (heightLeft >= 0) {
          position = heightLeft - imgHeight;
          pdf.addPage();
          pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
        }
        
        pdf.save(`ficha_membro_${membroData.nome || 'sem_nome'}.pdf`);
      });
      
      // Esconder o formul√°rio PDF novamente
      pdfForm.style.display = 'none';
    });

    // Inicializar visualiza√ß√£o
    toggleEditMode(false);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
