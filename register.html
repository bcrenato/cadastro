<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerenciar Usu치rios - Sistema Igreja</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
body { padding-top: 70px; background-color: #f8f9fa; }
.navbar { background-color: #4CAF50; }
.navbar .nav-link, .navbar .navbar-brand { color: #fff; }
.navbar .nav-link:hover, .navbar .navbar-brand:hover { color: #ddd; }
.admin-card { border-left: 4px solid #ffc107; }
</style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
<div class="container">
<a class="navbar-brand" href="index.html"><i class="fas fa-user-shield me-2"></i> Gerenciar Usu치rios</a>
<div class="collapse navbar-collapse">
<ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="index.html"><i class="fas fa-home"></i> In칤cio</a></li>
<li class="nav-item"><a class="nav-link active" href="register.html"><i class="fas fa-users-cog"></i> Usu치rios</a></li>
</ul>
</div>
</div>
</nav>

<div class="container mt-4">
<div class="row">
<div class="col-lg-6 mb-4">
<div class="card admin-card shadow">
<div class="card-header bg-white"><h3 class="text-center mb-0"><i class="fas fa-users text-primary me-2"></i> Usu치rios Cadastrados no DB</h3></div>
<div class="card-body">
<div class="table-responsive">
<table class="table table-hover">
<thead><tr><th>Nome</th><th>Usu치rio</th><th>Tipo</th><th>Habilitado</th><th>A칞칫es</th></tr></thead>
<tbody id="usersList"></tbody>
</table></div></div></div></div>

<div class="col-lg-6">
<div class="card admin-card shadow">
<div class="card-header bg-white"><h3 class="text-center mb-0"><i class="fas fa-user-clock text-primary me-2"></i> Usu치rios do Auth ainda n칚o no DB</h3></div>
<div class="card-body">
<ul id="authUsers" class="list-group"></ul>
</div></div></div></div></div>

<div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

<script type="module">
import { db, auth } from './firebase-config.js';
import { ref, get, set, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
import { getAllUsers, deleteUser, toggleUserEnabled, createUserInDB } from './users.js';

const usersList = document.getElementById('usersList');

// lista os usu치rios j치 no DB
async function loadUsers() {
const users = await getAllUsers();
usersList.innerHTML = '';
if (!users.length) {
usersList.innerHTML = '<tr><td colspan="5" class="text-center">Nenhum usu치rio cadastrado</td></tr>';
return;
}
users.forEach(user => {
const row = document.createElement('tr');
row.innerHTML = `
<td>${user.fullName}</td>
<td>${user.username}</td>
<td>${user.isAdmin ? 'Admin' : 'Usu치rio'}</td>
<td><input type="checkbox" class="enable-user" data-id="${user.id}" ${user.isEnabled ? 'checked' : ''}></td>
<td>
<button class="btn btn-danger btn-sm delete-user" data-id="${user.id}"><i class="fas fa-trash"></i></button>
</td>`;
usersList.appendChild(row);
});
document.querySelectorAll('.enable-user').forEach(cb => {
cb.addEventListener('change', async () => {
await toggleUserEnabled(cb.dataset.id, cb.checked);
showToast(`Usu치rio ${cb.checked ? 'habilitado' : 'desabilitado'}`);
});
});
document.querySelectorAll('.delete-user').forEach(btn => {
btn.addEventListener('click', async () => {
if (confirm('Excluir este usu치rio?')) {
await deleteUser(btn.dataset.id);
showToast('Usu치rio exclu칤do');
loadUsers();
}
});
});
}

function showToast(message, type='success') {
const toast = document.createElement('div');
toast.className = `toast show text-bg-${type} m-2`;
toast.innerHTML = `<div class="toast-body">${message}</div>`;
document.getElementById('toastContainer').appendChild(toast);
setTimeout(() => { toast.remove(); }, 3000);
}

// 游댱 Lista fake para simular usu치rios do Auth ainda n칚o no DB
const authUsers = [
  { uid: 'uid1', username: 'joao', displayName: 'Jo칚o da Silva' },
  { uid: 'uid2', username: 'maria', displayName: 'Maria Souza' }
];

function listarUsuariosAuth() {
  const ul = document.getElementById('authUsers');
  ul.innerHTML = '';

  authUsers.forEach(u => {
    const li = document.createElement('li');
    li.className = 'list-group-item d-flex justify-content-between align-items-center';
    li.innerHTML = `
      <span>${u.displayName} (${u.username})</span>
      <button class="btn btn-primary btn-sm" onclick="criarNoDB('${u.uid}','${u.username}','${u.displayName}')">
        Criar no DB
      </button>
    `;
    ul.appendChild(li);
  });
}

window.criarNoDB = async (uid, username, fullName) => {
  await createUserInDB(uid, username, fullName, false);
  showToast(`Usu치rio ${fullName} criado no DB!`);
  loadUsers();
};

document.addEventListener('DOMContentLoaded', () => {
  loadUsers();
  listarUsuariosAuth();
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
