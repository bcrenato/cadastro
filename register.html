<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Gerenciar Usu치rios</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">
<h2>Usu치rios j치 cadastrados no DB</h2>
<table class="table table-bordered">
<thead>
<tr>
<th>Nome</th>
<th>Usu치rio</th>
<th>Admin</th>
<th>Habilitado</th>
</tr>
</thead>
<tbody id="usersTable"></tbody>
</table>
</div>

<div class="container mt-4">
<h3>Usu치rios do Auth ainda n칚o cadastrados no DB</h3>
<ul id="authUsers" class="list-group"></ul>
</div>

<script type="module">
import { getAllUsers, toggleUserEnabled, createUserInDB } from './users.js';

// lista os usu치rios j치 no DB
async function listarUsuariosDB() {
  const usersTable = document.getElementById('usersTable');
  const users = await getAllUsers();
  usersTable.innerHTML = '';

  users.forEach(user => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${user.fullName}</td>
      <td>${user.username}</td>
      <td>${user.isAdmin ? 'Sim' : 'N칚o'}</td>
      <td>
        <input type="checkbox" ${user.isEnabled ? 'checked' : ''} onchange="habilitar('${user.id}', this.checked)">
      </td>
    `;
    usersTable.appendChild(tr);
  });
}

window.habilitar = async (uid, enabled) => {
  await toggleUserEnabled(uid, enabled);
  alert(`Usu치rio ${uid} ${enabled ? 'habilitado' : 'desabilitado'}`);
  listarUsuariosDB();
};

listarUsuariosDB();


// 游댱 Lista fake para simular usu치rios do Auth ainda n칚o no DB
const authUsers = [
  { uid: 'uid1', username: 'joao', displayName: 'Jo칚o da Silva' },
  { uid: 'uid2', username: 'maria', displayName: 'Maria Souza' }
];

function listarUsuariosAuth() {
  const ul = document.getElementById('authUsers');
  ul.innerHTML = '';

  authUsers.forEach(u => {
    const li = document.createElement('li');
    li.className = 'list-group-item d-flex justify-content-between align-items-center';
    li.innerHTML = `
      <span>${u.displayName} (${u.username})</span>
      <button class="btn btn-primary btn-sm" onclick="criarNoDB('${u.uid}','${u.username}','${u.displayName}')">
        Criar no DB
      </button>
    `;
    ul.appendChild(li);
  });
}

window.criarNoDB = async (uid, username, fullName) => {
  await createUserInDB(uid, username, fullName, false);
  alert(`Usu치rio ${fullName} criado no DB!`);
  listarUsuariosDB();
};

listarUsuariosAuth();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
